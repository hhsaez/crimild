# Build a crimild-based application, linking it with Crimild libraries
#
# Arguments:
# - CRIMILD_APP_NAME: (Required) Name for the example project
# - CRIMILD_APP_SOURCE_DIR: (Required) Base directory for sources

MESSAGE( "Configuring ${CRIMILD_APP_NAME} app" )

IF ( APPLE )
	# Enable C++11 features
	SET( CMAKE_CXX_FLAGS "-std=c++11 -stdlib=libc++ -U__STRICT_ANSI__" )

	set(CMAKE_XCODE_ATTRIBUTE_CLANG_CXX_LANGUAGE_STANDARD "c++0x")
	set(CMAKE_XCODE_ATTRIBUTE_CLANG_CXX_LIBRARY "libc++")
ELSE ( APPLE )
	SET( CMAKE_CXX_FLAGS "-std=c++11 -static-libgcc -static-libstdc++ -static -U__STRICT_ANSI__" )
ENDIF ( APPLE )

# TODO: Avoid the absolute path to the 'examples' directory
FILE( GLOB_RECURSE CRIMILD_APP_HEADER_FILES "${CRIMILD_APP_SOURCE_DIR}/*.hpp" )
FILE( GLOB_RECURSE CRIMILD_APP_SOURCE_FILES "${CRIMILD_APP_SOURCE_DIR}/*.cpp" )

SET( CRIMILD_APP_DEPENDENCIES 
	crimild_core
	crimild_opengl
	crimild_glfw
	crimild_scripting
	glfw 
)

SET( CRIMILD_APP_LINK_LIBRARIES 
	crimild_core
	crimild_opengl
	crimild_glfw
	crimild_scripting
	glfw 
)

SET( CRIMILD_APP_INCLUDE_DIRECTORIES 
	${CRIMILD_SOURCE_DIR}/core/src
	${CRIMILD_SOURCE_DIR}/opengl/src
	${CRIMILD_SOURCE_DIR}/scripting/src
	${CRIMILD_SOURCE_DIR}/glfw/src 
	${CRIMILD_SOURCE_DIR}/third-party/glfw/include
	${CRIMILD_SOURCE_DIR}/third-party/glew/include
	${CRIMILD_SOURCE_DIR}/third-party/lua-5.2.3/src
	${CRIMILD_APP_SOURCE_DIR}
) 

SET( CRIMILD_APP_LINK_DIRECTORIES 
	${CRIMILD_SOURCE_DIR}/lib 
	${CRIMILD_SOURCE_DIR}/third-party/glfw/src )

IF ( CRIMILD_ENABLE_AL )
	SET( CRIMILD_APP_DEPENDENCIES ${CRIMILD_APP_DEPENDENCIES} crimild_al )
	SET( CRIMILD_APP_LINK_LIBRARIES ${CRIMILD_APP_LINK_LIBRARIES} crimild_al )
	SET( CRIMILD_APP_INCLUDE_DIRECTORIES ${CRIMILD_APP_INCLUDE_DIRECTORIES} ${CRIMILD_SOURCE_DIR}/al/src )
ENDIF ( CRIMILD_ENABLE_AL )

IF ( CRIMILD_ENABLE_PHYSICS )
	SET( CRIMILD_APP_DEPENDENCIES ${CRIMILD_APP_DEPENDENCIES} crimild_physics )
	SET( CRIMILD_APP_LINK_LIBRARIES ${CRIMILD_APP_LINK_LIBRARIES} crimild_physics )
	SET( CRIMILD_APP_INCLUDE_DIRECTORIES ${CRIMILD_APP_INCLUDE_DIRECTORIES} ${CRIMILD_SOURCE_DIR}/third-party/bullet-2.82-r2704/src )
	SET( CRIMILD_APP_LINK_DIRECTORIES ${CRIMILD_APP_LINK_DIRECTORIES} ${CRIMILD_SOURCE_DIR}/third-party/bullet-2.82-r2704/lib )
ENDIF ( CRIMILD_ENABLE_PHYSICS )

INCLUDE_DIRECTORIES( ${CRIMILD_APP_INCLUDE_DIRECTORIES} )

LINK_DIRECTORIES( ${CRIMILD_APP_LINK_DIRECTORIES} )

IF ( APPLE )
	SET( CRIMILD_APP_LINK_LIBRARIES 
		${CRIMILD_APP_LINK_LIBRARIES} 
		"-framework Cocoa -framework OpenGL -framework IOKit -framework CoreVideo" )
ELSE ( APPLE )
	SET( CRIMILD_APP_LINK_LIBRARIES ${CRIMILD_APP_LINK_LIBRARIES} opengl32 glu32 winmm )
ENDIF ( APPLE )

ADD_EXECUTABLE( ${CRIMILD_APP_NAME}
	${CRIMILD_APP_SOURCE_FILES}
	${CRIMILD_APP_HEADER_FILES} )

TARGET_LINK_LIBRARIES( ${CRIMILD_APP_NAME} ${CRIMILD_APP_LINK_LIBRARIES} )

ADD_DEPENDENCIES( ${CRIMILD_APP_NAME} ${CRIMILD_APP_DEPENDENCIES} )
